<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kanaval: kanaval/inputs.hpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">kanaval
   </div>
   <div id="projectbrief">C++ library for validating kana files</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_cad48341f1c85806521c29a6597af908.html">kanaval</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">inputs.hpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Validate input contents.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;H5Cpp.h&quot;</code><br />
<code>#include &quot;utils.hpp&quot;</code><br />
<code>#include &lt;stdexcept&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;numeric&gt;</code><br />
<code>#include &lt;unordered_set&gt;</code><br />
<code>#include &lt;unordered_map&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for inputs.hpp:</div>
<div class="dyncontent">
<div class="center"><img src="inputs_8hpp__incl.png" border="0" usemap="#akanaval_2inputs_8hpp" alt=""/></div>
<map name="akanaval_2inputs_8hpp" id="akanaval_2inputs_8hpp">
<area shape="rect" title="Validate input contents." alt="" coords="304,5,435,32"/>
<area shape="rect" title=" " alt="" coords="5,80,77,107"/>
<area shape="rect" title=" " alt="" coords="102,80,173,107"/>
<area shape="rect" title=" " alt="" coords="197,80,275,107"/>
<area shape="rect" title=" " alt="" coords="300,80,359,107"/>
<area shape="rect" title=" " alt="" coords="383,80,438,107"/>
<area shape="rect" title=" " alt="" coords="462,80,530,107"/>
<area shape="rect" title=" " alt="" coords="555,80,659,107"/>
<area shape="rect" title=" " alt="" coords="683,80,794,107"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="inputs_8hpp__dep__incl.png" border="0" usemap="#akanaval_2inputs_8hppdep" alt=""/></div>
<map name="akanaval_2inputs_8hppdep" id="akanaval_2inputs_8hppdep">
<area shape="rect" title="Validate input contents." alt="" coords="10,5,141,32"/>
<area shape="rect" href="validate_8hpp.html" title="Validate the embedded state file of a kana file." alt="" coords="5,80,145,107"/>
</map>
</div>
</div>
<p><a href="inputs_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkanaval_1_1inputs_1_1Details.html">kanaval::inputs::Details</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structkanaval_1_1inputs_1_1Details.html" title="Details about the dataset.">Details</a> about the dataset.  <a href="structkanaval_1_1inputs_1_1Details.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacekanaval"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekanaval.html">kanaval</a></td></tr>
<tr class="memdesc:namespacekanaval"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utilities for validating kana files. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a38bcbcf0ca77ecb92031acc4a21d77e5"><td class="memItemLeft" align="right" valign="top">Details&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inputs_8hpp.html#a38bcbcf0ca77ecb92031acc4a21d77e5">kanaval::inputs::validate</a> (const H5::Group &amp;handle, bool embedded, int version)</td></tr>
<tr class="separator:a38bcbcf0ca77ecb92031acc4a21d77e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Validate input contents. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a38bcbcf0ca77ecb92031acc4a21d77e5" name="a38bcbcf0ca77ecb92031acc4a21d77e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38bcbcf0ca77ecb92031acc4a21d77e5">&#9670;&nbsp;</a></span>validate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Details kanaval::inputs::validate </td>
          <td>(</td>
          <td class="paramtype">const H5::Group &amp;&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>embedded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Check contents for the input step. Contents are stored inside an <code>inputs</code> HDF5 group at the root of the file. The <code>inputs</code> group itself contains the <code>parameters</code> and <code>results</code> subgroups.</p>
<p >In this section, a "matrix" refers to one or more files describing a single (count) matrix. This should be exactly one file for HDF5-based formats, or multiple files for MatrixMarket formats, e.g., to include feature information - see below for details. Multiple matrices may be supplied, in which case each matrix is assumed to contain data for one sample. Alternatively, a single matrix may contain data for one or more samples as partitioned by a sample factor.</p>
<p >The loaded dataset refers to the in-memory representation of the matrix (for single matrix inputs) or the combined matrices (for multiple inputs). The identities of the rows of the loaded dataset may be a permutation or subset of the rows in the input matrices. This is especially true for multiple inputs where the loaded dataset only contains the intersection of features across inputs. For multiple matrices, the loaded dataset is assumed to be a column-wise concatenation of the individual matrices after sorting them by <code>sample_names</code>.</p>
<hr  />
<p> <code>parameters</code> should contain:</p>
<ul>
<li><code>format</code>: a scalar string specifying the file format for a single matrix. This is usually either <code>"MatrixMarket"</code>, for a MatrixMarket file with possible feature/barcode annotations; <code>"10X"</code>, for the 10X Genomics HDF5 matrix format; or <code>"H5AD"</code>, for the H5AD format. Other values are allowed but their interpretation is implementation-defined (e.g., for custom resources). For multiple matrices, <code>format</code> should instead be a 1-dimensional string dataset of length equal to the number of uploads. Each element of the dataset is usually one of <code>"MatrixMarket"</code>, <code>"10X"</code> or <code>"H5AD"</code>; different values can be present for mixed input formats.</li>
<li><p class="startli"><code>files</code>: a group of groups representing an array of input file information. Each inner group is named by their positional index in the array and contains information about a file in an upload. Each inner group should contain:</p><ul>
<li><code>type</code>: a scalar string specifying the type of the file. For multiple matrices, the constraints below apply to all files corresponding to a single matrix.<ul>
<li>If <code>format = "MatrixMarket"</code>, there should be exactly one <code>type = "mtx"</code> corresponding to the (possibly Gzipped) <code>*.mtx</code> file. There may be zero or one <code>type = "genes"</code>, containing a (possibly Gzipped) TSV file with the Ensembl and gene symbols for each row. There may be zero or one <code>type = "annotations"</code>, containing a (possibly Gzipped) TSV file with the annotations for each column.</li>
<li>If <code>format = "10X"</code> or <code>"H5AD"</code>, there should be exactly one <code>type = "h5"</code>.</li>
<li>For other <code>format</code>s, any <code>type</code> can be used, typically for custom resources.</li>
</ul>
</li>
<li><code>name</code>: a scalar string specifying the file name as it was provided to <b>kana</b>.</li>
</ul>
<p class="startli">If <code>embedded = true</code>, we additionally expect:</p><ul>
<li><code>offset</code>: a scalar integer specifying where the file starts as an offset from the start of the remaining bytes section. The offset for the first file should be zero, and entries in <code>files</code> should be ordered by increasing <code>offset</code>.</li>
<li><code>size</code>: a non-negative scalar integer specifying the number of bytes in the file. The offset of each file should be equal to the sum of <code>size</code> and <code>offset</code> for the preceding file.</li>
</ul>
<p class="startli">If <code>embedded = false</code>, we expect:</p><ul>
<li><code>id</code>: a scalar string containing some unique identifier for this file. The interpretation of <code>id</code> is application-specific but usually refers to some cache or database.</li>
</ul>
</li>
</ul>
<p >Optionally, <code>parameters</code> may contain a <code>subset</code> group, specifying the subset of cells to be used in downstream steps. This group should either contain:</p>
<ul>
<li><code>indices</code>, a 1-dimensional integer dataset specifying the indices of the cells to retain. Indices should be relative to the loaded dataset before subsetting. The length of this dataset should be equal to the number of cells in <code>results/dimensions</code>. Indices should be unique and sorted.</li>
<li><code>field</code>, a string scalar specifying the field of the column annotations to use for filtering. This should be accompanied by <code>values</code>, a 1-dimensional string dataset specifying the allowable values for this field. The subset is defined as all cells with a <code>field</code> value in <code>values</code>.</li>
</ul>
<p >For multiple matrices, <code>parameters</code> should also contain:</p>
<ul>
<li><code>sample_groups</code>: an integer dataset of length equal to the number of samples. Each entry specifies the number of files in <code>files</code> that belong to a sample. (All files from the same sample are assumed to be contiguous in the array represented by <code>files</code>; so a <code>sample_groups</code> of <code>[3, 2, 1]</code> would mean that the first three files belong to the first sample, the next 2 files belong to the second sample, and the last file belongs to the third sample.)</li>
<li><code>sample_names</code>: a string dataset of length equal to the number of samples. Each value contains the name for the sample defined by the corresponding entry of <code>sample_groups</code>. All names should be unique and sorted.</li>
</ul>
<p >For single matrix inputs, <code>parameters</code> may also contain:</p>
<ul>
<li><code>sample_factor</code>: a string scalar specifying the field in the per-cell annotation that contains the sample blocking factor. If present, it is assumed that the matrix contains data for multiple samples.</li>
</ul>
<div style="color:blue"> <details>
 <summary>For version 1.0</summary> <code>parameters</code> should contain:</details>
</div><div style="color:blue"><details>
<ul>
<li><code>format</code>: a scalar string specifying the file format for a single matrix. This is usually either <code>"MatrixMarket"</code>, for a MatrixMarket file with possible feature/barcode annotations; <code>"10X"</code>, for the 10X Genomics HDF5 matrix format; or <code>"H5AD"</code>, for the H5AD format. Other values are allowed but their interpretation is implementation-defined (e.g., for custom resources). For multiple matrices, <code>format</code> should instead be a 1-dimensional string dataset of length equal to the number of uploads. Each element of the dataset is usually one of <code>"MatrixMarket"</code>, <code>"10X"</code> or <code>"H5AD"</code>; different values can be present for mixed input formats.}</li>
<li><p class="startli"><code>files</code>: a group of groups representing an array of input file information. Each inner group is named by their positional index in the array and contains information about a file in an upload. Each inner group should contain:</p><ul>
<li><code>type</code>: a scalar string specifying the type of the file.<ul>
<li>If <code>format = "MatrixMarket"</code>, there should be exactly one <code>type = "mtx"</code> corresponding to the (possibly Gzipped) <code>*.mtx</code> file. There may be zero or one <code>type = "genes"</code>, containing a (possibly Gzipped) TSV file with the Ensembl and gene symbols for each row. There may be zero or one <code>type = "annotations"</code>, containing a (possibly Gzipped) TSV file with the annotations for each column.</li>
<li>If <code>format = "10X"</code> or <code>"H5AD"</code>, there should be exactly one <code>type = "h5"</code>.</li>
<li>For other <code>format</code>s, any <code>type</code> can be used, typically for custom resources.</li>
</ul>
</li>
<li><code>name</code>: a scalar string specifying the file name as it was provided to <b>kana</b>.</li>
</ul>
<p class="startli">If <code>embedded = true</code>, we additionally expect:</p><ul>
<li><code>offset</code>: a scalar integer specifying where the file starts as an offset from the start of the remaining bytes section. The offset for the first file should be zero, and entries in <code>files</code> should be ordered by increasing <code>offset</code>.</li>
<li><code>size</code>: a non-negative scalar integer specifying the number of bytes in the file. The offset of each file should be equal to the sum of <code>size</code> and <code>offset</code> for the preceding file.</li>
</ul>
<p class="startli">If <code>embedded = false</code>, we expect:</p><ul>
<li><code>id</code>: a scalar string containing some unique identifier for this file. The interpretation of <code>id</code> is application-specific but usually refers to some cache or database.  </li>
</ul>
</li>
</ul>
</details>
</div><div style="color:blue"><details>
<hr  />
 <code>results</code> should contain:</details>
</div><div style="color:blue"><details>
<ul>
<li><code>num_cells</code>: an integer scalar specifying the number of cells in the loaded dataset.</li>
<li><code>num_features</code>: a group containing integer scalar datasets, each named after a modality (typically <code>"RNA"</code> and/or <code>"ADT"</code>). Each dataset contains the number of features for its named modality. When dealing with multiple matrix inputs, the number of features is defined as the intersection across all matrices.</li>
<li><code>identities</code>: a group containin 1-dimensional integer datasets, each named after a modality in <code>num_features</code>. Each dataset is of length equal to the number of features listed in its corresponding <code>num_features</code> dataset. Each dataset contains the identities of the rows in the loaded dataset corresponding to its named modality. If a single input was provided, <code>identities</code> identifies each row in terms of its index in the "original" input matrix (i.e., if it were loaded without any modification). If multiple inputs were provided, <code>identities</code> contains the intersection of features across inputs, and each value refers to the row index in the original matrix of the <em>first</em> input. Row identities are parallel to the per-feature results in subsequent analysis steps.</li>
</ul>
</details>
</div><div style="color:blue"><details>
<div style="color:blue"> <details>
 <summary>For version 1.2</summary> <code>results</code> should contain:</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<ul>
<li><code>dimensions</code>: an integer dataset of length 2, containing the number of features and the number of cells in the loaded dataset. When dealing with multiple matrix inputs, the first entry is instead defined as the size of the intersection of features across all matrices.</li>
<li><code>identities</code>: a 1-dimensional integer dataset of length equal to the first entry of <code>dimensions</code>, containing the identity of each row in the loaded dataset. If a single input was provided, <code>identities</code> identifies each row in terms of its index in the "original" input matrix (i.e., if it were loaded without any modification). If multiple inputs were provided, <code>identities</code> contains the intersection of features across inputs, and each value refers to the row index in the original matrix of the <em>first</em> input. Row identities are parallel to the per-gene results in subsequent analysis steps.</li>
</ul>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<code>results</code> may also contain:</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<ul>
<li><code>num_samples</code>: an integer scalar dataset specifying the number of samples. If absent, this is assumed to be 1. For multiple matrices, the value listed here should be consistent with the number of samples specified in the paramaters. </li>
</ul>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
 <summary>For version 1.1</summary> <code>results</code> should contain:</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<ul>
<li><code>dimensions</code>: an integer dataset of length 2, containing the number of features and the number of cells in the loaded dataset. When dealing with multiple matrix inputs, the first entry is instead defined as the size of the intersection of features across all matrices.</li>
</ul>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<code>results</code> may also contain:</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<ul>
<li><code>num_samples</code>: an integer scalar dataset specifying the number of samples. If absent, this is assumed to be 1. For multiple matrices, the value listed here should be consistent with the number of samples specified in the paramaters.</li>
</ul>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
If there is only a single matrix, <code>results</code> should also contain:</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<ul>
<li><code>permutation</code>: an integer dataset of length equal to the number of cells, describing the permutation to be applied to the per-gene results to recover the original row order.</li>
</ul>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
If there are multiple matrices, <code>results</code> should instead contain:</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<ul>
<li><code>indices</code>: an integer dataset containing the row index of each feature in the intersection. For each entry, the gene is defined as the indexed row in the first sample <em>without permutation</em>. The <code>indices</code> are parallel to the per-gene results. </li>
</ul>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<details>
 <summary>For version 1.0</summary> <code>results</code> should contain:</details>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<details>
<ul>
<li><code>dimensions</code>: an integer dataset of length 2, containing the number of features and the number of cells in the loaded dataset.</li>
<li><code>permutation</code>: an integer dataset of length equal to the number of cells, describing the permutation to be applied to the per-gene results to recover the original row order.  </li>
</ul>
</details>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<details>
All steps that generate per-gene results should use <code>identities</code> (or, for older formats, <code>permutation</code> or <code>indices</code>) to identify the genes corresponding to the statistics. See the documentation for the functions listed below:</details>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<details>
<ul>
<li><code><a class="el" href="inputs_8hpp.html#a38bcbcf0ca77ecb92031acc4a21d77e5">feature_selection::validate()</a></code></li>
<li><code><a class="el" href="inputs_8hpp.html#a38bcbcf0ca77ecb92031acc4a21d77e5">marker_detection::validate()</a></code></li>
<li><code><a class="el" href="inputs_8hpp.html#a38bcbcf0ca77ecb92031acc4a21d77e5">custom_selections::validate()</a></code></li>
</ul>
</details>
</details>
</details>
</div><p></details>
</div><div style="color:blue"><details>
<div style="color:blue"><details>
<details>
<details>
<hr  />
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>An open HDF5 file handle. </td></tr>
    <tr><td class="paramname">embedded</td><td>Whether the data files are embedded or linked. </td></tr>
    <tr><td class="paramname">version</td><td>Version of the state file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Details about the dataset. If the format is invalid, an error is raised instead. </dd></dl>
</details>
</details>
</details>
</div><p></details>
</div>
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
